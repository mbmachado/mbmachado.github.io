<!DOCTYPE html>
<html lang="pt-BR">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<title>Escalonador de Processos</title>
	<link rel="stylesheet" href="assets/vendor/materialize/css/material-icons.css">
	<link rel="stylesheet" href="assets/vendor/jQuery-ui-1.12.1/jquery-ui.min.css">
	<link rel="stylesheet" href="assets/vendor/materialize/css/materialize.min.css">
	<link rel="stylesheet" href="assets/css/stylesheet.css">
	<link rel="icon" href="assets/img/favicon.png">
	<link rel="manifest" href="manifest.json">
</head>
<body class="blue-grey lighten-5">
	<div class="row my-no-m-b">
		<div class="col s12 m3 l3 teal lighten-2 my-scrollabel">
			<div class="row my-no-m-b">
				<div class="col s12">
					<h5 class="center-align blue-grey-text text-lighten-5 my-no-m-b">Escalonador de Processos</h5>
					<p class="center-align blue-grey-text text-lighten-5 my-no-m-t my-m-b-10">By Enrique W., Mateus B. e Mateus C.</p>
				</div>
			</div>
			<div class="row">
				<div class="col s12">
					<div class="card-panel my-main-card">
						<div id="progress_bar" class="progress my-progress-bar indigo lighten-4">
						    <div class="indeterminate indigo darken-2"></div>
						</div>
						<div id="overlay_panel" class="my-overlay">
							<div id="inner_overlay_panel" class="my-inner-overlay">
								<div class="row">
									<div class="col s12 center-align">
										<span>Turnaround Médio</span>
									</div>
								</div>
								<div class="row">
									<div class="col s12 center-align">
										<span id="mean_turnaround"></span>
									</div>
								</div>
								<div class="row">
									<div class="col s12 center-align">
										<a id="replay_btn" class="waves-effect waves-light btn cyan lighten-2 pulse">De novo</a>
									</div>
								</div>
							</div>
						</div>
						<form id="main_form" action="#" method="POST">
							<div class="row my-no-m-b">
								<div class="input-field col s12">
						        	<input id="process_number" type="text" class="numbers" autocomplete="off">
						        	<label class="truncate" for="process_number">Número de Processos</label>
						        </div>
							</div>
							<div class="row my-no-m-b">
								<div class="input-field col s6">
						        	<input id="quamtum_number" type="text" class="1-to-9" autocomplete="off">
						        	<label for="quamtum_number">Quamtum</label>
						        </div>
						        <div class="input-field col s6">
						        	<input id="overload_number" type="text" class="1-to-9" autocomplete="off">
						        	<label for="overload_number">Sobrecarga</label>
						        </div>
							</div>
							<div class="row my-no-m-b">
								<div class="input-field col s12">
									<select id="page_replacement">
										<option value="FIFO" selected>FIFO</option>
										<option value="LRU">Menos recentemente utilizado</option>
									</select>
									<label>Substituição de Páginas</label>
								</div>
							</div>
							<div class="row my-no-m-b">
								<div class="col s12">
									<label>Algoritmo de escalonamento</label>
									<p>
										<label>
											<input class="with-gap" name="algorithm" value="FIFO" type="radio" checked/>
											<span>FIFO</span>
										</label>
									</p>
									<p>
										<label>
											<input class="with-gap" name="algorithm" value="SJF" type="radio"/>
											<span>SJF</span>
										</label>
									</p>
									<p>
										<label>
											<input class="with-gap" name="algorithm" value="RR" type="radio"/>
											<span>Round Robin</span>
										</label>
									</p>
									<p>
										<label>
											<input class="with-gap" name="algorithm" value="EDF" type="radio"/>
											<span>EDF</span>
										</label>
									</p>
								</div>
							</div>
							<div class="row my-no-m-b">
								<div class="col s6 m4">
									<button class="btn waves-effect waves-light" type="submit" name="action">Iniciar</button>
								</div>
								<div class="col s6 m4">
									<button id="reset_btn" class="btn waves-effect waves-red blue-grey lighten-4 blue-grey-text text-darken-4" type="reset">Limpar</button>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
		<div class="col s12 m9 l9 blue-grey lighten-5 my-scrollabel">
			<div id="processes_info_box" class="row"></div>
			<div id="graphs_box" class="row">
				<div class="col s12">
					<div class="card-panel">
						<div class="row">
							<div class="col s12">
								<h6>Gráfico de Gantt</h6>
							</div>
						</div>
						<div id="gantt_graph" class="my-gantt-graph"></div>
						<div class="row">
							<div class="col s6 m2 valign-wrapper my-s-m-b-5">
								<div class="my-subtitle-square teal lighten-2"></div>
								<label>Executando</label>
							</div>
							<div class="col s6 m2 valign-wrapper my-s-m-b-5">
								<div class="my-subtitle-square red lighten-2"></div>
								<label>Sobrecarga</label>
							</div>
							<div class="col s6 m2 valign-wrapper my-s-m-b-5">
								<div class="my-subtitle-square blue-grey lighten-2"></div>
								<label>Estouro DL</label>
							</div>
							<div class="col s6 m2 valign-wrapper my-s-m-b-5">
								<div class="my-subtitle-line indigo darken-2"></div>
								<label>DeadLine</label>
							</div>
							<div class="col s12 m4">
								<div class="switch right-align my-switch">
								    <label>
								    	Rolagem automática
								    	<input type="checkbox" checked>
								    	<span class="lever my-lever"></span>
								    </label>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="col s12">
					<div class="row">
						<div class="col s12 m6">
							<div class="card-panel">
								<div class="row">
									<div  class="col s12">
										<h6>Memória RAM</h6>
									</div>
								</div>
								<div id="mem_graph" class="my-mem-graph"></div>
							</div>
						</div>
						<div class="col s12 m6">
							<div class="card-panel">
								<div class="row">
									<div class="col s12">
										<h6>Disco</h6>
									</div>
								</div>
								<div id="hd_graph" class="my-hd-graph"></div>
							</div>
						</div>
						
					</div>
				</div>
			</div>
		</div>
    </div>
    <div id="draggable_pages_table" class="draggable resizable ui-widget-content">
		<div class="card">
			<div class="card-content">
				<div class="row">
					<div class="col s6 my-no-p">
						<h6>Tabela de Páginas</h6>
					</div>
					<div class="col s6 my-no-p">
						<a id="hide_btn" class="waves-effect waves-red btn-flat right"><i class="material-icons">close</i></a>
					</div>
				</div>
				<div id="pages_graph" class="my-pages-graph"></div>
			</div>
		</div>
	</div>
    <div id="toggle_container" class="fixed-action-btn">
    	<a id="toggle_btn" href="#" class="btn-floating btn-large waves-effect waves-light"><i class="material-icons">library_books</i></a>
    </div>
    <div id="error_modal" class="modal">
	    <div class="modal-content">
	      <h4>Erro</h4>
	      <p id="modal_content"></p>
	    </div>
	    <div class="modal-footer">
	      <a href="#!" class="modal-close waves-effect waves-teal btn-flat">Ok</a>
	    </div>
  	</div>
	<script src="assets/vendor/jQuery/jquery-3.3.1.min.js"></script>
	<script src="assets/vendor/jQuery-ui-1.12.1/jquery-ui.min.js"></script>
	<script src="assets/vendor/jQuery-Mask-Plugin/dist/jquery.mask.min.js"></script>
	<script src="assets/vendor/velocity/velocity.min.js"></script>
	<script src="assets/vendor/materialize/js/materialize.min.js"></script>
	<script src="assets/js/script.js"></script>
	<script>
		"use strict";
		var data;
		var ioWait=[];
		var sortData;
		var currentProcess;
		var extremeDeadline = 1000000;
		var freeMemory, freeHd;
		var mainForm = $("#main_form");
		var processNumberInput = $("#process_number");
		var quamtumNumberInput = $("#quamtum_number");
		var overloadNumberInput = $("#overload_number");
		var pageReplacementInput = $("#page_replacement");
		var resetButton = $("#reset_btn");
		var progressBar = $("#progress_bar");
		var overlayPanel = $("#overlay_panel");
		var innerOverlayPanel = $("#inner_overlay_panel");
		var meanTurnaroundSpan = $("#mean_turnaround");

		var processesInfoBox = $("#processes_info_box");
		var graphsBox = $("#graphs_box");
		var ganttGraph = $("#gantt_graph");
		var visibleGanttGraphWidth = ganttGraph.width();
		var progressGanttGraphWidth;
		var maxGanttGraphCol = 30;
		var scrollPosition = 65;
		var lastScrollDelay = 0;

		var errorModal = $("#error_modal");
		var modalContent = $("#modal_content");
		var replayBtn = $("#replay_btn");

		var globalDelay = 0;
		var green = "#4db6ac";
		var red = "#e57373";
		var grey = "#90a4ae";
		var colors = ["#4db6ac", "#e57373", "#90a4ae"];

		var memGraph = $("#mem_graph");
		var hdGraph = $("#hd_graph");
		var pagesGraph = $("#pages_graph");
		var pagesTable = $('#draggable_pages_table');
		var hideBtn = $("#hide_btn");
		var	toggleBtn = $("#toggle_btn");
		var	toggleContainer = $("#toggle_container");

		function choiceProcess(actualTime) {
			var minDeadline = extremeDeadline;
			var marcado=0;
			for(let j=0; j<sortData.length; j++){
				if(sortData[j]._start <= actualTime && sortData[j]._timeLeft > 0 && sortData[j]._deadline < minDeadline && sortData[j]._makingIO==0){

					if(sortData[j]._memoria==-1 && freeMemory>0){
						minDeadline = sortData[j]._deadline;
						currentProcess = j;
						marcado=1;
					}else if(sortData[j]._memoria==-1){
						sortData[j]._makingIO=1;
						//colocar na memoria
					}else{
						minDeadline = sortData[j]._deadline;
						currentProcess = j;
						marcado=1;
					}
				}	
			}
			if(sortData[j]._memoria==-1 && freeMemory>0){
				putMemoryWIthFreeSpace(currentProcess);
			}
		}

		function remJustHD(pro){
			var ini=sortData[proc]._hd*10+1;
			sortData[proc]._hd=-1;
			for(let i=0; i<10; i++){
				removeProcessFromRAM(ini+i);
			}
			freeMemory++;
		}	

		function remJustRAM(pro){
			var ini=sortData[proc]._memoria*10+1;
			sortData[proc]._memoria=-1;
			for(let i=0; i<10; i++){
				removeProcessFromRAM(ini+i);
			}
			freeMemory++;
		}		

		function putJustInRAM(proc, col){
			var ini=col*10+1;
			sortData[proc]._memoria=col;
			for(let i=0; i<10; i++){
				setProcessInRAM(ini+i, sortData[proc]._processNumber);
			}
		}
		
		function putMemoryWIthFreeSpace(proc){
			if(sortData[proc]._hd==-1){
				sortData[proc]._hd=10-freeHd;
				var ini = (10-freeHd)*10+1;
				for(let i=0; i<10; i++){
					setProcessInHD(ini+i, sortData[proc]._processNumber);
				}
				freeHd--;
			}
			ini=(5-freeMemory)*10+1;
			sortData[proc]._memoria=5-freeMemory;
			freeMemory--;
			for(let i=0; i<10; i++){
				setProcessInRAM(ini+i, sortData[proc]._processNumber);
			}
		}

		function choiceProcess2(actualTime){
			var marcado=0;
			currentProcess=-1;
			for(let i=0; i<sortData.length; i++){
				if(sortData[i]._start <= actualTime && marcado==0 && sortData[i]._makingIO==0 && sortData[i]._timeLeft>0){
					if(sortData[i]._memoria==-1 && freeMemory>0){
						putMemoryWIthFreeSpace(i);
						marcado=1;
						currentProcess=i;
					}else if(sortData[i]._memoria==-1){
						sortData[i]._makingIO=1;
						//colocar na memoria
					}else{
						marcado=1;
						currentProcess=i;
					}
				}
			}
		}

		function choiceProcessSJF(actualTime){
			var marcado=0;
			currentProcess=-1;
			var procAux=10000000000000;
			for(let i=0; i<sortData.length; i++){
				if(sortData[i]._start <= actualTime && sortData[i]._makingIO==0 && sortData[i]._timeLeft>0 && sortData[i]._time < procAux){
					if(sortData[i]._memoria==-1 && freeMemory>0){
						putMemoryWIthFreeSpace(i);
						currentProcess=i
						procAux = sortData[i]._time;
					}else if(sortData[i]._memoria==-1){
						sortData[i]._makingIO=1;
						//colocar na memoria
					}else{
						currentProcess=i
						procAux = sortData[i]._time;
					}
				}
			}	
		}


		function fifo2(){
			var lastPosition = 0;
			var i = 0;
			var tam = sortData.length;
			while(i < tam){
				currentProcess = -1;
				choiceProcess2(lastPosition);
				while(currentProcess == -1){
					lastPosition++;
					choiceProcess2(lastPosition);
				}
				for(let j=0; j<sortData[i]._time; j++) {
					makeProgressInGanttSquare(sortData[currentProcess]._processNumber, lastPosition);
					lastPosition++;
				}
				sortData[currentProcess]._endTime=lastPosition;
				sortData[currentProcess]._timeLeft=0;
				//remJustRAM(currentProcess);
				//remJustHD(currentProcess);
				i++;
			}
		}


		function fifo() {
			var lastPosition = 0;
			for(let i= 0; i < sortData.length; i++) {
				if(lastPosition < sortData[i]._start) {
					lastPosition = sortData[i]._start;
				}
				for(let j=0; j<sortData[i]._time; j++) {
					makeProgressInGanttSquare(sortData[i]._processNumber, lastPosition);
					lastPosition++;
				}
				sortData[i]._endTime = lastPosition;
			}
		}
        
        function sjf() {
			var lastPosition = 0;
			var lastPosition = 0;
			var i = 0;
			var tam = sortData.length;
			while(i < tam){
				currentProcess = -1;
				choiceProcessSJF(lastPosition);
				while(currentProcess == -1){
					lastPosition++;
					choiceProcess2(lastPosition);
				}
				for(let j=0; j<sortData[i]._time; j++) {
					makeProgressInGanttSquare(sortData[currentProcess]._processNumber, lastPosition);
					lastPosition++;
				}
				sortData[currentProcess]._endTime=lastPosition;
				sortData[currentProcess]._timeLeft=0;
				//remJustRAM(currentProcess);
				//remJustHD(currentProcess);
				i++;
			}            
		}
        
        function roundRobin() {
            var lastPosition = 0;
            var spinning = [];
            var count = 0;
            var countLastPos = 0;
            var currentProcess;
            var timeForExecution;
            var nextIsOver;
            var rrIsOver = false;
            var spinningIsOver = false;
            
            while(!rrIsOver){
                
                if(lastPosition < sortData[count]._start) {
					lastPosition = sortData[count]._start;
				}
                for (;count < sortData.length; count++) {
                    if (sortData[count]._start <= lastPosition) {
                        spinning.push(count);
                    }else{
                        break;
                    }
                }
                    
                spinningIsOver = false;
                while (!spinningIsOver){
                    if (spinning.length <= 0){ break; }
                    currentProcess = spinning.shift();
                    if(sortData[currentProcess]._timeLeft <= data["quantum"]) {
                        timeForExecution = sortData[currentProcess]._timeLeft;
                        nextIsOver = true;
                    }else{
                        timeForExecution = data["quantum"];
                        nextIsOver = false;
                    }
                    sortData[currentProcess]._timeLeft -= timeForExecution;

                    for(let j = 0; j < timeForExecution; j++) {
                        makeProgressInGanttSquare(sortData[currentProcess]._processNumber, lastPosition);
                        lastPosition++;
                    }
                    if(nextIsOver) {
                        sortData[currentProcess]._endTime = lastPosition;
                        for (;count < sortData.length; count++) {
                            if (sortData[count]._start <= lastPosition) {
                                spinning.push(count);
                            }else{
                                break;
                            }
                        }
                        if (spinning.length <= 0){
                            spinningIsOver = true;
                        }
                    }else {
                        for(let j = 0; j < data["overload"]; j++) {
                            makeProgressInGanttSquare(sortData[currentProcess]._processNumber, lastPosition, red);
                            lastPosition++;
                        }
                        for (; count < sortData.length; count++) {
                            if (sortData[count]._start <= lastPosition) {
                                spinning.push(count);
                            }else{
                                break;
                            }
                        }
                        spinning.push(currentProcess);
                    }
                }
                
                if (count >= sortData.length) { rrIsOver = true; }
            }
        }

		function edf() {
			var lastPosition = 0;
			var finhishedProcess = 0;
			var allProcess = sortData.length;
			var timeForExecution;
			var timeAfterDeadline;
			var endOneProcess = 0;
			var proc = 0;
			for (var i = 0; i < sortData.length; i++) {
				colorizeBorder(sortData[i]._processNumber, sortData[i]._deadline);
			}

			while(finhishedProcess < allProcess) {
				currentProcess = -1;
				endOneProcess = 0;
				timeForExecution = 0;
				choiceProcess(lastPosition);
				while(currentProcess == -1){
					lastPosition++;
					choiceProcess(lastPosition);
				}
				
				if(sortData[currentProcess]._timeLeft <= data["quantum"]) {
					timeForExecution = sortData[currentProcess]._timeLeft;
					endOneProcess = 1;
				} else {
					timeForExecution = data["quantum"];
				}

				sortData[currentProcess]._timeLeft = sortData[currentProcess]._timeLeft - timeForExecution;
				var colorConsideringDeadline = 0;
				for(let j = 0; j < timeForExecution; j++){
					if(sortData[currentProcess]._deadline <= lastPosition){
						colorConsideringDeadline=2;
					}
					makeProgressInGanttSquare(sortData[currentProcess]._processNumber, lastPosition, colors[colorConsideringDeadline]);
					lastPosition++;
				}
				if(endOneProcess == 1){
					finhishedProcess++;
					sortData[currentProcess]._endTime = lastPosition;
					remJustHD(currentProcess);
					remJustRAM(currentProcess);
				}else { 
					for(let j = 0; j < data["overload"]; j++) {
						makeProgressInGanttSquare(sortData[currentProcess]._processNumber, lastPosition, red);
						lastPosition++;
					}
				}
			}
		}

		function meanTurnAround() {
			let turnAround = 0;
			for(let i = 0; i < sortData.length; i++) {
				turnAround+=(sortData[i]._endTime - sortData[i]._start);
			}
			return turnAround/sortData.length;
		}

		function setProcessInRAM(pageFrame, _process) {
			let square = $("#mem_page_"+pageFrame);
			let element = $("#mem_page_"+pageFrame+" span ~ span");
			
			square.css('background-color', '#b2dfdb');
			element.html('P '+_process);
		}

		function removeProcessFromRAM(pageFrame) {
			let square = $("#mem_page_"+pageFrame);
			let element = $("#mem_page_"+pageFrame+" span ~ span");
			
			square.css('background-color', '#fff');
			element.html('P x');
		}

		function setProcessInHD(local, _process) {
			let square = $("#hd_page_"+local);
			let element = $("#hd_page_"+local+" span ~ span");
			
			square.css('background-color', '#b2dfdb');
			element.html('P '+_process);
		}

		function removeProcessFromHD(local) {
			let square = $("#hd_page_"+local);
			let element = $("#hd_page_"+local+" span ~ span");
			
			square.css('background-color', '#fff');
			element.html('P x');
		}

		function setTablePages(virtualPage, pageFrame) {
			let element = $("#pages_page_"+virtualPage+" span:nth-child(2)");
			element.html('F '+pageFrame);
		}

		function resetTablePages(virtualPage) {
			let element = $("#pages_page_"+virtualPage+" span:nth-child(2)");
			element.html('F x');
		}

		function setTablePagesBit(virtualPage, pageFrame) {
			let square = $("#pages_page_"+virtualPage);
			let _element = $("#pages_page_"+virtualPage+" span:nth-child(3)");
			square.css('background-color', '#b2dfdb');
			_element.html('Bit 1');
		}

		function resetTablePagesBit(virtualPage) {
			let square = $("#pages_page_"+virtualPage);
			let _element = $("#pages_page_"+virtualPage+" span:nth-child(3)");
			square.css('background-color', '#fff');
			_element.html('Bit 0');
		}

		function main() {
			freeMemory=5;
			freeHd=10;
			switch (data["algorithm"]) {
			    case "FIFO":
			        fifo2(); 
			        break;
			    case "SJF":
			        sjf();
			        break;
			    case "RR":
			        roundRobin();
			        break;
			    case "EDF":
			        edf();
			        break;
			    default:
			    	window.alert("Erro Fatal");
       				break;
			}

		/*	setProcessInRAM(2, 0);
			setProcessInHD(2, 0);
			setTablePages(2, 2);
			setTablePagesBit(2, 2);
		*/
			setTimeout(function() { 
				ganttGraph.stop('fx', true, false);
				progressBar.fadeOut('fast');
				meanTurnaroundSpan.html(meanTurnAround()+" min");
				innerOverlayPanel.show('fast');
			}, globalDelay );
		
		}

		processNumberInput.on('change', function(event) {
			event.preventDefault();
			processesInfoBox.empty();
			let n = parseInt(processNumberInput.val());
			for (let i = 0; i < n; i++) {
				processesInfoBox.append(
					'<div class="col s12 m4">\
						<div class="card">\
					        <div class="card-content">\
					        	<span class="card-title my-no-m-b">Processo '+i+'</span>\
					        	<div class="row my-no-m-b">\
							        <div class="input-field col s4">\
							        	<input id="process_'+i+'_start" type="text" class="0-to-99" autocomplete="off">\
							        	<label for="process_'+i+'_start">Chegada</label>\
							        </div>\
									<div class="input-field col s4">\
							        	<input id="process_'+i+'_time" type="text" class="0-to-99" autocomplete="off">\
							        	<label for="process_'+i+'_time">Tempo</label>\
							        </div>\
							        <div class="input-field col s4">\
							        	<input id="process_'+i+'_deadline" type="text" class="0-to-99" autocomplete="off">\
							        	<label for="process_'+i+'_deadline">Deadline</label>\
							        </div>\
								</div>\
					        </div>\
					    </div>\
				    </div>'
				);
			}
			$('.0-to-99').mask('00');
			graphsBox.hide(0, function() {
				processesInfoBox.show('fast');
			});
		});

		mainForm.on('submit', function(event) {
			event.preventDefault();
			let n = parseInt(processNumberInput.val()), errorMsg = ""; data = [];
			if(!(processNumberInput.val()).length) {
				errorMsg += "Número de processos não pode ser nulo!<br>";
			} else {
				for (let i = 0; i < n; i++) {
					if(!($("#process_"+i+"_start").val()).length || !($("#process_"+i+"_time").val()).length || !($("#process_"+i+"_deadline").val()).length) {
						errorMsg += "Dados do processo "+i+" estão incompletos!<br>";
					} else {
						data[i] = {
							"_start"    : parseInt($("#process_"+i+"_start").val()), 
							"_time"     : parseInt($("#process_"+i+"_time").val()),
							"_deadline" : parseInt($("#process_"+i+"_deadline").val()),
						};
					}
				}
				data["processes"] = parseInt(processNumberInput.val());
			}
			if (!(quamtumNumberInput.val()).length) {
				errorMsg += "Quamtum não pode ser nulo!<br>";
			} else {
				data["quantum"] = parseInt(quamtumNumberInput.val()); 
			}  
			if (!(overloadNumberInput.val()).length) {
				errorMsg += "Sobrecarga não pode ser nulo!<br>";
			} else {
				data["overload"] = parseInt(overloadNumberInput.val()); 
			}
			if(!(errorMsg).length) {
				processesInfoBox.hide(0, function(){
					graphsBox.show('fast');
					progressBar.show('fast');
					overlayPanel.show('fast');
				});
				data["algorithm"] = $("input[name=algorithm]:checked", "#main_form").val();
				data["pageReplacement"] = pageReplacementInput.val();
				for (let i = 0; i < n; i++) {
					$("#outer_info_square_"+i+"_0 span").html(data[i]._start);
					$("#outer_info_square_"+i+"_1 span").html(data[i]._time);
					$("#outer_info_square_"+i+"_2 span").html(data[i]._deadline);
					$("#outer_info_square_"+i+"_3 span").html(i);
				}
				sortByArrivalTime();
				main();
			} else {
				modalContent.html(errorMsg);
				errorModal.modal('open');
			}
		});

		resetButton.on('click', function(event) {
			processesInfoBox.empty();
			processesInfoBox.hide(0, function() {
				graphsBox.show('fast');
			});
		});

		$(function() {
			$('.draggable').draggable();
			$('.resizable').resizable();
		});

		$( document ).ready(function() {
			$('select').formSelect();
			$('.modal').modal();
			$('.numbers').mask('0#');
			$('.1-to-9').mask('n', {
			    translation: {
			      	'n': {
			    		pattern: /[1-9]/
			    	}
			    }
			});

			for (let d = ['TC', 'TE', 'D', 'Nº'], i = 0; i < 4; i++) {
				ganttGraph.append('\
					<div class="my-gantt-col">\
						<div class="my-gantt-square"><span>'+d[i]+'</span></div>\
						<div id="outer_info_square_9_'+i+'" class="my-gantt-square"><span></span></div>\
						<div id="outer_info_square_8_'+i+'" class="my-gantt-square"><span></span></div>\
						<div id="outer_info_square_7_'+i+'" class="my-gantt-square"><span></span></div>\
						<div id="outer_info_square_6_'+i+'" class="my-gantt-square"><span></span></div>\
						<div id="outer_info_square_5_'+i+'" class="my-gantt-square"><span></span></div>\
						<div id="outer_info_square_4_'+i+'" class="my-gantt-square"><span></span></div>\
						<div id="outer_info_square_3_'+i+'" class="my-gantt-square"><span></span></div>\
						<div id="outer_info_square_2_'+i+'" class="my-gantt-square"><span></span></div>\
						<div id="outer_info_square_1_'+i+'" class="my-gantt-square"><span></span></div>\
						<div id="outer_info_square_0_'+i+'" class="my-gantt-square"><span></span></div>\
					</div>\
				');
			}
			for (let i = 0; i < 31; i++) {
				ganttGraph.append('\
					<div class="my-gantt-col">\
						<div class="my-gantt-square"><span>'+i+'</span></div>\
						<div id="outer_square_9_'+i+'" class="my-gantt-square"><div id="inner_square_9_'+i+'" class="my-gantt-inner-square"></div></div>\
						<div id="outer_square_8_'+i+'" class="my-gantt-square"><div id="inner_square_8_'+i+'" class="my-gantt-inner-square"></div></div>\
						<div id="outer_square_7_'+i+'" class="my-gantt-square"><div id="inner_square_7_'+i+'" class="my-gantt-inner-square"></div></div>\
						<div id="outer_square_6_'+i+'" class="my-gantt-square"><div id="inner_square_6_'+i+'" class="my-gantt-inner-square"></div></div>\
						<div id="outer_square_5_'+i+'" class="my-gantt-square"><div id="inner_square_5_'+i+'" class="my-gantt-inner-square"></div></div>\
						<div id="outer_square_4_'+i+'" class="my-gantt-square"><div id="inner_square_4_'+i+'" class="my-gantt-inner-square"></div></div>\
						<div id="outer_square_3_'+i+'" class="my-gantt-square"><div id="inner_square_3_'+i+'" class="my-gantt-inner-square"></div></div>\
						<div id="outer_square_2_'+i+'" class="my-gantt-square"><div id="inner_square_2_'+i+'" class="my-gantt-inner-square"></div></div>\
						<div id="outer_square_1_'+i+'" class="my-gantt-square"><div id="inner_square_1_'+i+'" class="my-gantt-inner-square"></div></div>\
						<div id="outer_square_0_'+i+'" class="my-gantt-square"><div id="inner_square_0_'+i+'" class="my-gantt-inner-square"></div></div>\
					</div>\
				');
			}

			for (let i = 0, j = 1; i < 10; i++) {
				if(j < 51) {
					var t = "blue-grey-text";
				} else {
					var t = "red-text text-lighten-2"
				}
				if (!(i==9)) {
					memGraph.append('\
						<div class="my-mem-col">\
							<div id="mem_page_'+j+'" class="my-mem-square my-t-b"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
							<div id="mem_page_'+j+'" class="my-mem-square"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
							<div id="mem_page_'+j+'" class="my-mem-square"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
							<div id="mem_page_'+j+'" class="my-mem-square"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
							<div id="mem_page_'+j+'" class="my-mem-square"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
							<div id="mem_page_'+j+'" class="my-mem-square"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
							<div id="mem_page_'+j+'" class="my-mem-square"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
							<div id="mem_page_'+j+'" class="my-mem-square"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
							<div id="mem_page_'+j+'" class="my-mem-square"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
							<div id="mem_page_'+j+'" class="my-mem-square"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
						</div>\
					');
				} else {
					memGraph.append('\
						<div class="my-mem-col">\
							<div id="mem_page_'+j+'" class="my-mem-square my-r-b my-t-b"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
							<div id="mem_page_'+j+'" class="my-mem-square my-r-b"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
							<div id="mem_page_'+j+'" class="my-mem-square my-r-b"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
							<div id="mem_page_'+j+'" class="my-mem-square my-r-b"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
							<div id="mem_page_'+j+'" class="my-mem-square my-r-b"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
							<div id="mem_page_'+j+'" class="my-mem-square my-r-b"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
							<div id="mem_page_'+j+'" class="my-mem-square my-r-b"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
							<div id="mem_page_'+j+'" class="my-mem-square my-r-b"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
							<div id="mem_page_'+j+'" class="my-mem-square my-r-b"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
							<div id="mem_page_'+j+'" class="my-mem-square my-r-b"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
						</div>\
					');
				}
			}

			for (let i = 0, j = 1; i < 10; i++) {
				var t = "blue-grey-text";
				if (!(i==9)) {
					hdGraph.append('\
						<div class="my-hd-col">\
							<div id="hd_page_'+j+'" class="my-hd-square my-t-b"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
							<div id="hd_page_'+j+'" class="my-hd-square"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
							<div id="hd_page_'+j+'" class="my-hd-square"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
							<div id="hd_page_'+j+'" class="my-hd-square"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
							<div id="hd_page_'+j+'" class="my-hd-square"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
							<div id="hd_page_'+j+'" class="my-hd-square"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
							<div id="hd_page_'+j+'" class="my-hd-square"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
							<div id="hd_page_'+j+'" class="my-hd-square"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
							<div id="hd_page_'+j+'" class="my-hd-square"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
							<div id="hd_page_'+j+'" class="my-hd-square"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
						</div>\
					');
				} else {
					hdGraph.append('\
						<div class="my-hd-col">\
							<div id="hd_page_'+j+'" class="my-hd-square my-r-b my-t-b"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
							<div id="hd_page_'+j+'" class="my-hd-square my-r-b"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
							<div id="hd_page_'+j+'" class="my-hd-square my-r-b"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
							<div id="hd_page_'+j+'" class="my-hd-square my-r-b"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
							<div id="hd_page_'+j+'" class="my-hd-square my-r-b"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
							<div id="hd_page_'+j+'" class="my-hd-square my-r-b"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
							<div id="hd_page_'+j+'" class="my-hd-square my-r-b"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
							<div id="hd_page_'+j+'" class="my-hd-square my-r-b"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
							<div id="hd_page_'+j+'" class="my-hd-square my-r-b"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
							<div id="hd_page_'+j+'" class="my-hd-square my-r-b"><span class="'+t+'">'+(j++)+'</span><span>P x</span></div>\
						</div>\
					');
				}
			}

			for (let i = 0, j = 1; i < 10; i++) {
				var t = "blue-grey-text";
				if (!(i==9)) {
					pagesGraph.append('\
						<div class="my-pages-col">\
							<div id="pages_page_'+j+'" class="my-pages-square my-t-b"><span class="'+t+'">'+(j++)+'</span><span>F x</span><span>Bit 0</span></div>\
							<div id="pages_page_'+j+'" class="my-pages-square"><span class="'+t+'">'+(j++)+'</span><span>F x</span><span>Bit 0</span></div>\
							<div id="pages_page_'+j+'" class="my-pages-square"><span class="'+t+'">'+(j++)+'</span><span>F x</span><span>Bit 0</span></div>\
							<div id="pages_page_'+j+'" class="my-pages-square"><span class="'+t+'">'+(j++)+'</span><span>F x</span><span>Bit 0</span></div>\
							<div id="pages_page_'+j+'" class="my-pages-square"><span class="'+t+'">'+(j++)+'</span><span>F x</span><span>Bit 0</span></div>\
							<div id="pages_page_'+j+'" class="my-pages-square"><span class="'+t+'">'+(j++)+'</span><span>F x</span><span>Bit 0</span></div>\
							<div id="pages_page_'+j+'" class="my-pages-square"><span class="'+t+'">'+(j++)+'</span><span>F x</span><span>Bit 0</span></div>\
							<div id="pages_page_'+j+'" class="my-pages-square"><span class="'+t+'">'+(j++)+'</span><span>F x</span><span>Bit 0</span></div>\
							<div id="pages_page_'+j+'" class="my-pages-square"><span class="'+t+'">'+(j++)+'</span><span>F x</span><span>Bit 0</span></div>\
							<div id="pages_page_'+j+'" class="my-pages-square"><span class="'+t+'">'+(j++)+'</span><span>F x</span><span>Bit 0</span></div>\
						</div>\
					');
				} else {
					pagesGraph.append('\
						<div class="my-pages-col">\
							<div id="pages_page_'+j+'" class="my-pages-square my-r-b my-t-b"><span class="'+t+'">'+(j++)+'</span><span>F x</span><span>Bit 0</span></div>\
							<div id="pages_page_'+j+'" class="my-pages-square my-r-b"><span class="'+t+'">'+(j++)+'</span><span>F x</span><span>Bit 0</span></div>\
							<div id="pages_page_'+j+'" class="my-pages-square my-r-b"><span class="'+t+'">'+(j++)+'</span><span>F x</span><span>Bit 0</span></div>\
							<div id="pages_page_'+j+'" class="my-pages-square my-r-b"><span class="'+t+'">'+(j++)+'</span><span>F x</span><span>Bit 0</span></div>\
							<div id="pages_page_'+j+'" class="my-pages-square my-r-b"><span class="'+t+'">'+(j++)+'</span><span>F x</span><span>Bit 0</span></div>\
							<div id="pages_page_'+j+'" class="my-pages-square my-r-b"><span class="'+t+'">'+(j++)+'</span><span>F x</span><span>Bit 0</span></div>\
							<div id="pages_page_'+j+'" class="my-pages-square my-r-b"><span class="'+t+'">'+(j++)+'</span><span>F x</span><span>Bit 0</span></div>\
							<div id="pages_page_'+j+'" class="my-pages-square my-r-b"><span class="'+t+'">'+(j++)+'</span><span>F x</span><span>Bit 0</span></div>\
							<div id="pages_page_'+j+'" class="my-pages-square my-r-b"><span class="'+t+'">'+(j++)+'</span><span>F x</span><span>Bit 0</span></div>\
							<div id="pages_page_'+j+'" class="my-pages-square my-r-b"><span class="'+t+'">'+(j++)+'</span><span>F x</span><span>Bit 0</span></div>\
						</div>\
					');
				}
			}
		});

		function sortByArrivalTime() {
			sortData = [];
			var start;
			var time;
			var deadline;
			var timeLeft;
			var position;
			var io = 0;
			var processNumber;
			var endTime=0;
			var hd1=-1;

			for(let i = 0; i < data.length; i++) {
				sortData[i] = {
					"_start"         : parseInt(data[i]._start), 
					"_time"          : parseInt(data[i]._time),
					"_deadline"      : parseInt(data[i]._deadline + data[i]._start),
					"_timeLeft"      : parseInt(data[i]._time),
					"_processNumber" : parseInt(i),
					"_makingIO"      : parseInt(io),
					"_endTime"       : parseInt(endTime),
					"_memoria"		 : parseInt(hd1),
					"_hd"			 : parseInt(hd1)
				};
			}

			for(let i = 0; i < sortData.length; i++) {
				position = i;
				for(let j = i+1; j<sortData.length; j++) {
					if(sortData[position]._start > sortData[j]._start) {
						position = j;
					}
				}
				if(position != i){
					start = sortData[i]._start;
					time = sortData[i]._time;
					deadline = sortData[i]._deadline;
					timeLeft = sortData[i]._timeLeft;
					processNumber =  sortData[i]._processNumber;
					sortData[i]._start = sortData[position]._start;
					sortData[i]._time = sortData[position]._time;
					sortData[i]._deadline = sortData[position]._deadline;
					sortData[i]._timeLeft = sortData[position]._timeLeft;
					sortData[i]._processNumber = sortData[position]._processNumber;
					sortData[position]._start = start;
					sortData[position]._time = time;
					sortData[position]._deadline =  deadline;
					sortData[position]._timeLeft = timeLeft;
					sortData[position]._processNumber = processNumber;
				}
			}
		}

		function colorizeBorder(y, x) {
			let square = $("#outer_square_"+y+"_"+x);
			square.css("border-left-color", "#303f9f");
		}

		function makeProgressInGanttSquare(y, x, color=green, _delay=(globalDelay+=600)) {
			if(x == maxGanttGraphCol) {
				let i = ++maxGanttGraphCol;
				ganttGraph.append('\
					<div class="my-gantt-col">\
						<div class="my-gantt-square"><span>'+i+'</span></div>\
						<div id="outer_square_9_'+i+'" class="my-gantt-square"><div id="inner_square_9_'+i+'" class="my-gantt-inner-square"></div></div>\
						<div id="outer_square_8_'+i+'" class="my-gantt-square"><div id="inner_square_8_'+i+'" class="my-gantt-inner-square"></div></div>\
						<div id="outer_square_7_'+i+'" class="my-gantt-square"><div id="inner_square_7_'+i+'" class="my-gantt-inner-square"></div></div>\
						<div id="outer_square_6_'+i+'" class="my-gantt-square"><div id="inner_square_6_'+i+'" class="my-gantt-inner-square"></div></div>\
						<div id="outer_square_5_'+i+'" class="my-gantt-square"><div id="inner_square_5_'+i+'" class="my-gantt-inner-square"></div></div>\
						<div id="outer_square_4_'+i+'" class="my-gantt-square"><div id="inner_square_4_'+i+'" class="my-gantt-inner-square"></div></div>\
						<div id="outer_square_3_'+i+'" class="my-gantt-square"><div id="inner_square_3_'+i+'" class="my-gantt-inner-square"></div></div>\
						<div id="outer_square_2_'+i+'" class="my-gantt-square"><div id="inner_square_2_'+i+'" class="my-gantt-inner-square"></div></div>\
						<div id="outer_square_1_'+i+'" class="my-gantt-square"><div id="inner_square_1_'+i+'" class="my-gantt-inner-square"></div></div>\
						<div id="outer_square_0_'+i+'" class="my-gantt-square"><div id="inner_square_0_'+i+'" class="my-gantt-inner-square"></div></div>\
					</div>\
				');
			}

			if(progressGanttGraphWidth == undefined) {
				progressGanttGraphWidth = x * 37 + 185;
			} else {
				progressGanttGraphWidth += 37;
			}

			let square = $("#inner_square_"+y+"_"+x);
			square.css('background-color', color);

			if(progressGanttGraphWidth >= visibleGanttGraphWidth) {
				ganttGraph.delay(_delay - lastScrollDelay).animate({scrollLeft:scrollPosition}, 400);
				lastScrollDelay = _delay;
				scrollPosition += 65;
			}

			square.velocity({width: "100%"}, {duration:600, delay: _delay, mobileHA: false});
			/*Different approach*///square.delay(_delay).animate({width: "100%"}, 600);
		}

		replayBtn.on('click', function(event) {
			event.preventDefault();
			location.reload();
		});		

		$( window ).resize(function() {
			visibleGanttGraphWidth = ganttGraph.width();
		});

		pagesTable.resize(function() {
			let width = pagesTable.width();
			if(width > 520) {
				pagesGraph.css('justify-content', 'center');
			} else {
				pagesGraph.css('justify-content', 'flex-start');
			}
		});

		var oldValue;
		processNumberInput.on('input', function(event) {
			var newValue = processNumberInput.val();
			if(!newValue.length) {
				oldValue = undefined; 
			} else if (parseInt(newValue) < 1) {
				processNumberInput.val(oldValue);
			} else if (parseInt(newValue) > 10) {
				processNumberInput.val(oldValue);
			} else {
				oldValue = newValue;
			}
		});

		hideBtn.on('click', function(event) {
			event.preventDefault();
			pagesTable.toggle();
			toggleContainer.toggle();
		});

		toggleBtn.on('click', function(event) {
			event.preventDefault();
			pagesTable.toggle();
			toggleContainer.toggle();
		});

	</script>
</body>
</html>